<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.yunovo.iov.fc.dao.ICcUserMapper">

	<select id="getUserInfoByUsernameAndStatus" resultType="cn.yunovo.iov.fc.model.entity.CcUser" parameterType="String">
		SELECT * FROM CC_USER WHERE USERNAME = #{username} AND status = 1
	</select>
	
	<select id="userListPage" resultType="cn.yunovo.iov.fc.model.result.UserResultBean">
		
		SELECT
			C.org_id,
			C.username,
			C.firstname,
			C.create_by,
			C.update_by,
			C.orgpos,
			C.date_last,
			C.date_added,
			C.`status`
		FROM
			cc_user AS C
		WHERE 1 = 1
		<choose>

			<when test="org_id != null">
				AND C.org_id = #{org_id}
			</when>
			<otherwise>
				<choose>
					<when test='orgpos == "*"'>

					</when>
					<otherwise>
						AND C.org_id IN
						<foreach collection="orgs" item="id" index="index"
							open="(" close=")" separator=",">
							#{id}
						</foreach>
					</otherwise>
				</choose>
			</otherwise>

		</choose>
		
		<if test="username != null">
			<bind name="username_bind" value="'%'+username+'%'" />
			AND C.username LIKE #{username_bind}
		</if>
		
		<if test="firstname != null">
			<bind name="firstname_bind" value="'%'+firstname+'%'" />
			AND C.firstname LIKE #{firstname_bind}
		</if>
		
	</select>
	
	<update id="updateByUsername" parameterType="cn.yunovo.iov.fc.model.entity.CcUser">
	
		update cc_user set status = #{u.status}, 
		
		<if test="u.org_id != null">
			org_id = #{u.org_id},
		</if>
		
		<if test="u.orgpos != null">
			orgpos = #{u.orgpos},
		</if>
		date_last = #{u.date_last}, 
		update_by = #{u.update_by}
		where username = #{u.username}
		
	</update>
	
	<!-- 根据机构编号获取此机构下开了多少个用户数 -->
	<select id="getTotalByOrg" resultType="java.lang.Integer">
	
		SELECT COUNT(*) FROM cc_user WHERE org_id = #{org_id}
	</select>
	
</mapper>
