<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.yunovo.iov.fc.dao.ICcStatsMapper">

	<!-- 统计分析-运营数据 -->
	<select id="getItemsPage" resultType="cn.yunovo.iov.fc.model.entity.CcStats">
	
	SELECT stats_date, SUM(rlname_cards) AS rlname_cards, SUM(card_total) AS card_total, SUM(pay_total) AS pay_total,
		SUM(pay_count) AS pay_count, SUM(pay_failed) AS pay_failed, SUM(pay_succeed) AS pay_succeed, SUM(online_count) AS online_count,
		SUM(online_api) AS online_api,SUM(online_other) AS online_other, SUM(active_total) AS active_total,
		SUM(active_count) AS active_count,SUM(active_unicom) AS active_unicom, SUM(active_device) AS active_device,
		SUM(stop_total) AS stop_total,SUM(stop_count) AS stop_count, SUM(stop_yreport) AS stop_yreport,SUM(stop_nreport) AS stop_nreport,
		SUM(used2g_total) AS used2g_total, SUM(used2g_pay) AS used2g_pay, SUM(rebate_money) AS rebate_money, SUM(pay_failed_money) AS pay_failed_money,
		SUM(pay_succeed_money) AS pay_succeed_money,SUM(used_amount) AS used_amount FROM cc_stats WHERE  1 =1 
	
		<choose>

			<when test="org_id != null">
				AND org_id = #{org_id}
			</when>
			<otherwise>
				<choose>
					<when test='orgpos == "*"'>

					</when>
					<otherwise>
						AND org_id IN
						<foreach collection="orgs" item="id" index="index"
							open="(" close=")" separator=",">
							#{id}
						</foreach>
					</otherwise>
				</choose>
			</otherwise>

		</choose>
	
		<if test="date_start != null">
			<![CDATA[  AND time_added >= #{date_start} ]]>
		</if>

		<if test="date_end != null">
			<![CDATA[ AND time_added <= #{date_end} ]]>
		</if>
		
		 GROUP BY stats_date
	</select>

</mapper>
